# redis AOF RDB

## 持久化机制备份数据

### RDB 

二进制快照文件

- 文件紧凑
- 占用空间小
- 恢复速度比较快
- 对Redis本身读写性能影响较小（子进程Fork模式）

### AOF 

记录了Redis的操作命令，重放请求恢复数据，AOF的文件会比RDB大

流程：

- 将执行命令记录在AOF缓存，之后再写入到磁盘（时间根据参数决定）
- 三种方式写入
  - 关闭时
  - 每秒定期
  - 执行完命令后立刻
  

- 丢失的数据比RDB少（按照第三种方式）
- AOF会影响执行速度，所有一般按照第二种方式写入，对性能影响不大



### 注意点：

- 当AOF文件过大时，redis会自动在后台Fork一个子进程对AOF进行重写（比如：同一个key的set操作只执行最后的一次）
- 重写过程中，redis会将新的操作记录在原来的AOF缓冲区和重写缓冲区都记录，当新的AOF创建完成，redis就会将重写缓冲区内容追加到新的AOf文件
  ，再用新的AOF文件替换原来的AOF文件

